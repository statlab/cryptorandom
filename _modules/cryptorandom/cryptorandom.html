
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cryptorandom.cryptorandom &#8212; cryptorandom 0.3 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>cryptorandom 0.3 documentation</span></a></h1>
        <h2 class="heading"><span>cryptorandom.cryptorandom</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for cryptorandom.cryptorandom</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SHA-256 PRNG prototype in Python</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="c1"># Import base class for PRNGs</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="c1"># Import library of cryptographic hash functions</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="c1"># Define useful constants</span>
<span class="n">BPF</span> <span class="o">=</span> <span class="mi">53</span>        <span class="c1"># Number of bits in a float</span>
<span class="n">RECIP_BPF</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**-</span><span class="n">BPF</span>
<span class="n">HASHLEN</span> <span class="o">=</span> <span class="mi">256</span> <span class="c1"># Number of bits in a hash output</span>
<span class="n">RECIP_HASHLEN</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**-</span><span class="n">HASHLEN</span>

<span class="c1">################################################################################</span>
<span class="c1">############################## Int from Hash ###################################</span>
<span class="c1">################################################################################</span>

<span class="k">def</span> <span class="nf">int_from_hash_py2</span><span class="p">(</span><span class="nb">hash</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert byte(s) to ints, specific for Python versions &lt; 3.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hash : bytes</span>
<span class="sd">        Hash or list of hashes to convert to integers</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int or list ndarray of ints</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">hash_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">hash</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hash_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">hash</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hash_int</span>


<span class="k">def</span> <span class="nf">int_from_hash_py3</span><span class="p">(</span><span class="nb">hash</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert byte(s) to ints, specific for Python 3.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hash : bytes</span>
<span class="sd">        Hash or list of hashes to convert to integers</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int or list ndarray of ints</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">hash_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">hash</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hash_int</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hash_int</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">int_from_hash</span> <span class="o">=</span> <span class="n">int_from_hash_py2</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">int_from_hash</span> <span class="o">=</span> <span class="n">int_from_hash_py3</span>


<span class="c1">################################################################################</span>
<span class="c1">############################## SHA-256 Class ###################################</span>
<span class="c1">################################################################################</span>

<div class="viewcode-block" id="SHA256"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256">[docs]</a><span class="k">class</span> <span class="nc">SHA256</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PRNG based on the SHA-256 cryptographic hash function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an instance of the SHA-256 PRNG.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        seed : {None, int, string} (optional)</span>
<span class="sd">            Random seed used to initialize the PRNG. It can be an integer of arbitrary length,</span>
<span class="sd">             a string of arbitrary length, or `None`. Default is `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hashfun</span> <span class="o">=</span> <span class="s2">&quot;SHA-256&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basehash</span><span class="p">()</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; r = SHA256(5)</span>
<span class="sd">        &gt;&gt;&gt; repr(r)</span>
<span class="sd">        &#39;SHA256 PRNG. seed: 5 counter: 0 randbits_remaining: 0&#39;</span>
<span class="sd">        &gt;&gt;&gt; str(r)</span>
<span class="sd">        &#39;SHA256 PRNG. seed: 5 counter: 0 randbits_remaining: 0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stringrepr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; PRNG. seed: &quot;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; counter: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s2">&quot; randbits_remaining: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stringrepr</span>


    <span class="k">def</span> <span class="nf">_basehash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the SHA256 hash function with given seed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hashinput</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basehash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">hashinput</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basehash</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="SHA256.seed"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.seed">[docs]</a>    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseseed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize internal seed and hashable object with counter 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseseed : {None, int, string} (optional)</span>
<span class="sd">            Random seed used to initialize the PRNG. It can be an integer of arbitrary length,</span>
<span class="sd">            a string of arbitrary length, or `None`. Default is `None`.</span>
<span class="sd">        counter : int (optional)</span>
<span class="sd">            Integer that counts how many times the PRNG has been called. The counter</span>
<span class="sd">             is used to update the internal state after each step. Default is 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;baseseed&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">baseseed</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span> <span class="o">=</span> <span class="n">baseseed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_basehash</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="SHA256.setstate"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.setstate">[docs]</a>    <span class="k">def</span> <span class="nf">setstate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseseed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">counter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">randbits_remaining</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the state (seed and counter)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseseed : {None, int, string} (optional)</span>
<span class="sd">            Random seed used to initialize the PRNG. It can be an integer of arbitrary length,</span>
<span class="sd">            a string of arbitrary length, or `None`. Default is `None`.</span>
<span class="sd">        counter : int (optional)</span>
<span class="sd">            Integer that counts how many times the PRNG has been called. The counter</span>
<span class="sd">             is used to update the internal state after each step. Default is 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">baseseed</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basehash</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basehash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="n">counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">=</span> <span class="n">randbits_remaining</span></div>


<div class="viewcode-block" id="SHA256.getstate"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.getstate">[docs]</a>    <span class="k">def</span> <span class="nf">getstate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current state of the PRNG</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseseed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.jumpahead"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.jumpahead">[docs]</a>    <span class="k">def</span> <span class="nf">jumpahead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jump ahead n steps in the period</span>

<span class="sd">        &gt;&gt;&gt; r = SHA256(5)</span>
<span class="sd">        &gt;&gt;&gt; r.jumpahead(5)</span>
<span class="sd">        &gt;&gt;&gt; repr(r)</span>
<span class="sd">        &#39;SHA256 PRNG with seed 5 and counter 5&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basehash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">*</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.next"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increment the counter and basehash by one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jumpahead</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.nextRandom"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.nextRandom">[docs]</a>    <span class="k">def</span> <span class="nf">nextRandom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the next hash value</span>

<span class="sd">        &gt;&gt;&gt; r = SHA256(12345678901234567890)</span>
<span class="sd">        &gt;&gt;&gt; r.next()</span>
<span class="sd">        &gt;&gt;&gt; r.nextRandom()</span>
<span class="sd">        4da594a8ab6064d666eab2bdf20cb4480e819e0c3102ca353de57caae1d11fd1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Apply SHA-256, interpreting digest output as integer</span>
        <span class="c1"># to yield 256-bit integer (a python &quot;long integer&quot;)</span>
        <span class="n">hash_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basehash</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hash_output</span></div>


<div class="viewcode-block" id="SHA256.random"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.random">[docs]</a>    <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate random numbers between 0 and 1.</span>
<span class="sd">        size controls the number of ints generated. If size=None, just one is produced.</span>
<span class="sd">        The following tests match the output of Ron&#39;s and Philip&#39;s implementations.</span>

<span class="sd">        &gt;&gt;&gt; r = SHA256(12345678901234567890)</span>
<span class="sd">        &gt;&gt;&gt; r.random(2)</span>
<span class="sd">        array([0.9272915426537484, 0.1916135318809483], dtype=object)</span>
<span class="sd">        &gt;&gt;&gt; r.random((2, 2))</span>
<span class="sd">        array([[0.5846237047310486, 0.18694233108130068],</span>
<span class="sd">               [0.9022661737961881, 0.052310932788987144]], dtype=object)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : {int, tuple, None}</span>
<span class="sd">            If None (default), return a single random number.</span>
<span class="sd">            If size is an int, return that many random numbers.</span>
<span class="sd">            If size is a tuple, it determines the shape of an array</span>
<span class="sd">            filled with random numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hash_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">int_from_hash</span><span class="p">(</span><span class="n">hash_output</span><span class="p">)</span><span class="o">*</span><span class="n">RECIP_HASHLEN</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">hash_output</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size2</span><span class="p">)]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">int_from_hash</span><span class="p">(</span><span class="n">hash_output</span><span class="p">)</span><span class="o">*</span><span class="n">RECIP_HASHLEN</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.randint_trunc"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.randint_trunc">[docs]</a>    <span class="k">def</span> <span class="nf">randint_trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated. For large values of (b-a), this algorithm does not produce integers</span>
<span class="sd">        uniformly at random.</span>
<span class="sd">        </span>
<span class="sd">        Generate random integers between a (inclusive) and b (exclusive).</span>
<span class="sd">        size controls the number of ints generated. If size=None, just one is produced.</span>

<span class="sd">        &gt;&gt;&gt; r = SHA256(12345678901234567890)</span>
<span class="sd">        &gt;&gt;&gt; r.randint_trunc(0, 5, size=3)</span>
<span class="sd">        array([0, 0, 0])</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : int</span>
<span class="sd">            lower limit (included in samples)</span>
<span class="sd">        b : int</span>
<span class="sd">            upper limit (not included in samples)</span>
<span class="sd">        size : {int, tuple, None}</span>
<span class="sd">            If None (default), return a single random number.</span>
<span class="sd">            If size is an int, return that many random numbers.</span>
<span class="sd">            If size is a tuple, it determines the shape of an array</span>
<span class="sd">            filled with random numbers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">,</span> <span class="s2">&quot;lower and upper limits are switched&quot;</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">int_from_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">())</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">int_from_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">())</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">))</span> \
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size</span><span class="p">))]),</span> <span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.getrandbits"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.getrandbits">[docs]</a>    <span class="k">def</span> <span class="nf">getrandbits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate k pseudorandom bits.</span>

<span class="sd">        If self.randbits contains at least k bits, returns k of those bits and removes them.</span>
<span class="sd">        If self.randbits has fewer than k bits, calls self.nextRandom() as many times as needed to</span>
<span class="sd">        populate self.randbits with at least k random bits, returns those k, and keeps</span>
<span class="sd">        any remaining bits in self.randbits</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : int</span>
<span class="sd">            number of pseudorandom bits</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># initialize the cache</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">=</span> <span class="n">int_from_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">=</span> <span class="n">HASHLEN</span>
        <span class="k">while</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span><span class="p">:</span> <span class="c1"># pre-pend more random bits</span>
            <span class="c1"># accounts for leading 0s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">=</span> <span class="p">(</span><span class="n">int_from_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextRandom</span><span class="p">())</span> <span class="o">&lt;&lt;</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">+</span> <span class="n">HASHLEN</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># harvest least significant k bits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits_remaining</span> <span class="o">-</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbits</span> <span class="o">&gt;&gt;</span> <span class="n">k</span> <span class="c1"># discard the k harvested bits</span>
        <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="SHA256.randbelow_from_randbits"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.randbelow_from_randbits">[docs]</a>    <span class="k">def</span> <span class="nf">randbelow_from_randbits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a random integer between 0 (inclusive) and n (exclusive).</span>
<span class="sd">        Raises ValueError if n==0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            upper limit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>   <span class="c1"># 0 &lt;= r &lt; 2**k</span>
        <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHA256.randint"><a class="viewcode-back" href="../../api/cryptorandom.html#cryptorandom.cryptorandom.SHA256.randint">[docs]</a>    <span class="k">def</span> <span class="nf">randint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate random integers between a (inclusive) and b (exclusive).</span>
<span class="sd">        size controls the number of ints generated. If size=None, just one is produced.</span>

<span class="sd">        &gt;&gt;&gt; r = SHA256(12345678901234567890)</span>
<span class="sd">        &gt;&gt;&gt; r.randint(0, 5, size=3)</span>
<span class="sd">        array([3, 2, 4])</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : int</span>
<span class="sd">            lower limit (included in samples)</span>
<span class="sd">        b : int</span>
<span class="sd">            upper limit (not included in samples)</span>
<span class="sd">        size : {int, tuple, None}</span>
<span class="sd">            If None (default), return a single random number.</span>
<span class="sd">            If size is an int, return that many random numbers.</span>
<span class="sd">            If size is a tuple, it determines the shape of an array</span>
<span class="sd">            filled with random numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">,</span> <span class="s2">&quot;lower and upper limits are switched&quot;</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbelow_from_randbits</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">randbelow_from_randbits</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size</span><span class="p">))]),</span> <span class="n">size</span><span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018-2021, Kellie Ottoboni and Philip B. Stark.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.1.
    </div>
  </body>
</html>